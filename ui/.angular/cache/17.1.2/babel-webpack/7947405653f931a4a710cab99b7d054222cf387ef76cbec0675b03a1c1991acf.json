{"ast":null,"code":"import * as i0 from '@angular/core';\nimport { InjectionToken, Injectable, Optional, Inject, NgModule } from '@angular/core';\nconst GoogleTagManagerConfigService = new InjectionToken('google-tag-manager-config');\n// adapted from https://github.com/auth0/auth0-angular#dynamic-configuration\nlet GoogleTagManagerConfiguration = /*#__PURE__*/(() => {\n  class GoogleTagManagerConfiguration {\n    constructor(googleTagManagerConfig) {\n      this._googleTagManagerConfig = {\n        id: null,\n        gtm_auth: '',\n        gtm_preview: ''\n      };\n      if (googleTagManagerConfig) {\n        this.set(googleTagManagerConfig);\n      }\n    }\n    set(googleTagManagerConfig) {\n      this._googleTagManagerConfig = googleTagManagerConfig;\n    }\n    get() {\n      return this._googleTagManagerConfig;\n    }\n    static #_ = this.ɵfac = function GoogleTagManagerConfiguration_Factory(t) {\n      return new (t || GoogleTagManagerConfiguration)(i0.ɵɵinject(GoogleTagManagerConfigService, 8));\n    };\n    static #_2 = this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: GoogleTagManagerConfiguration,\n      factory: GoogleTagManagerConfiguration.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return GoogleTagManagerConfiguration;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet GoogleTagManagerService = /*#__PURE__*/(() => {\n  class GoogleTagManagerService {\n    constructor(googleTagManagerConfiguration, googleTagManagerId, googleTagManagerMode = \"noisy\", googleTagManagerAuth, googleTagManagerPreview, googleTagManagerResourcePath, googleTagManagerCSPNonce) {\n      this.googleTagManagerConfiguration = googleTagManagerConfiguration;\n      this.googleTagManagerId = googleTagManagerId;\n      this.googleTagManagerMode = googleTagManagerMode;\n      this.googleTagManagerAuth = googleTagManagerAuth;\n      this.googleTagManagerPreview = googleTagManagerPreview;\n      this.googleTagManagerResourcePath = googleTagManagerResourcePath;\n      this.googleTagManagerCSPNonce = googleTagManagerCSPNonce;\n      this.isLoaded = false;\n      this.browserGlobals = {\n        windowRef() {\n          return window;\n        },\n        documentRef() {\n          return document;\n        }\n      };\n      this.config = this.googleTagManagerConfiguration?.get();\n      if (this.config == null) {\n        this.config = {\n          id: null\n        };\n      }\n      this.config = {\n        ...this.config,\n        id: googleTagManagerId || this.config.id,\n        gtm_auth: googleTagManagerAuth || this.config.gtm_auth,\n        gtm_preview: googleTagManagerPreview || this.config.gtm_preview,\n        gtm_resource_path: googleTagManagerResourcePath || this.config.gtm_resource_path\n      };\n      if (this.config.id == null) {\n        return;\n      }\n    }\n    checkForId() {\n      if (this.googleTagManagerMode !== \"silent\" && !this.config.id) {\n        throw new Error('Google tag manager ID not provided.');\n      } else if (!this.config.id) {\n        return false;\n      }\n      return true;\n    }\n    getDataLayer() {\n      this.checkForId();\n      const window = this.browserGlobals.windowRef();\n      window.dataLayer = window.dataLayer || [];\n      return window.dataLayer;\n    }\n    pushOnDataLayer(obj) {\n      this.checkForId();\n      const dataLayer = this.getDataLayer();\n      dataLayer.push(obj);\n    }\n    addGtmToDom() {\n      return new Promise((resolve, reject) => {\n        if (this.isLoaded) {\n          return resolve(this.isLoaded);\n        } else if (!this.checkForId()) {\n          return resolve(false);\n        }\n        const doc = this.browserGlobals.documentRef();\n        this.pushOnDataLayer({\n          'gtm.start': new Date().getTime(),\n          event: 'gtm.js'\n        });\n        const gtmScript = doc.createElement('script');\n        gtmScript.id = 'GTMscript';\n        gtmScript.async = true;\n        gtmScript.src = this.applyGtmQueryParams(this.config.gtm_resource_path ? this.config.gtm_resource_path : 'https://www.googletagmanager.com/gtm.js');\n        gtmScript.addEventListener('load', () => {\n          return resolve(this.isLoaded = true);\n        });\n        gtmScript.addEventListener('error', () => {\n          return reject(false);\n        });\n        if (this.googleTagManagerCSPNonce) {\n          gtmScript.setAttribute('nonce', this.googleTagManagerCSPNonce);\n        }\n        doc.head.insertBefore(gtmScript, doc.head.firstChild);\n      });\n    }\n    pushTag(item) {\n      return new Promise((resolve, reject) => {\n        if (!this.checkForId()) {\n          return resolve();\n        }\n        if (!this.isLoaded) {\n          this.addGtmToDom().then(() => {\n            this.pushOnDataLayer(item);\n            return resolve();\n          }).catch(() => reject());\n        } else {\n          this.pushOnDataLayer(item);\n          return resolve();\n        }\n      });\n    }\n    applyGtmQueryParams(url) {\n      if (url.indexOf('?') === -1) {\n        url += '?';\n      }\n      return url + Object.keys(this.config).filter(k => this.config[k]).map(k => `${k}=${this.config[k]}`).join('&');\n    }\n    static #_ = this.ɵfac = function GoogleTagManagerService_Factory(t) {\n      return new (t || GoogleTagManagerService)(i0.ɵɵinject(GoogleTagManagerConfiguration, 8), i0.ɵɵinject('googleTagManagerId', 8), i0.ɵɵinject('googleTagManagerMode', 8), i0.ɵɵinject('googleTagManagerAuth', 8), i0.ɵɵinject('googleTagManagerPreview', 8), i0.ɵɵinject('googleTagManagerResourcePath', 8), i0.ɵɵinject('googleTagManagerCSPNonce', 8));\n    };\n    static #_2 = this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: GoogleTagManagerService,\n      factory: GoogleTagManagerService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return GoogleTagManagerService;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet GoogleTagManagerModule = /*#__PURE__*/(() => {\n  class GoogleTagManagerModule {\n    static forRoot(config) {\n      return {\n        ngModule: GoogleTagManagerModule,\n        providers: [{\n          provide: GoogleTagManagerConfigService,\n          useValue: config\n        }]\n      };\n    }\n    static #_ = this.ɵfac = function GoogleTagManagerModule_Factory(t) {\n      return new (t || GoogleTagManagerModule)();\n    };\n    static #_2 = this.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n      type: GoogleTagManagerModule\n    });\n    static #_3 = this.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({});\n  }\n  return GoogleTagManagerModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/*\n * Public API Surface of angular-google-tag-manager\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { GoogleTagManagerConfigService, GoogleTagManagerConfiguration, GoogleTagManagerModule, GoogleTagManagerService };\n//# sourceMappingURL=angular-google-tag-manager.mjs.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}